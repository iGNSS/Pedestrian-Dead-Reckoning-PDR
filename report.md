<style>
h1 {
    text-align: center;
}
h2, h3 {
    page-break-after: avoid; 
}
.center {
    margin: 0 auto;
    width: fit-content;
    margin-top: 2em;
    padding-top: 0.5em;
    padding-bottom: 0.5em;
    margin-bottom: 2em;
}
.title {
    font-weight: bold;
    border-top-style: solid;
    border-bottom-style: solid;
}
.newpage {
    page-break-after: always
}
@media print {
    @page {
        margin: 3cm;
    }
}
</style>

<h1 style="margin-top: 4em">
高级机器学习作业
</h1>

# <h1 class="center title">PDR: 室内行人移动方位推算技术</h1>

<div class="center">
<h3>院系：人工智能学院</h3>
<h3>组长：方盛俊 (201300035)</h3>
<h3>组员：任圣杰 (201300036)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;曹明隽 (201300031)</h3>
<h3>邮箱：201300035@smail.nju.edu.cn</h3>
<h3>时间：2022 年 11 月 30 日</h3>
</div>

<div class="newpage"></div>

<!-- 生成目录 -->

## <h1>目录</h1>

[TOC]

<div class="newpage"></div>

<!-- 文章主体内容 -->

## 一、问题描述

### 1.1 问题背景

室内 GPS 信号受到阻隔，尤其时车库场景无线接入点 AP 较为稀疏，室内定位很难通过 GPS 或位置指纹等技术实现。行人行位推算技术（Pedestrian Dead Reckoning，PDR）可以有效解决这一问题，它利用手机内置传感器收集数据，通过轻量级低功耗算法运行框架和技术，实现稳定可靠、高精度的方位推算计算。

### 1.2  输入

输入为 CSV 格式，其每一行都有数据值及采集到该数据时的时间（从开始收集计算），以加速度计为例：

```csv
"Time (s)","Acceleration x (m/s^2)","Acceleration y (m/s^2)","Acceleration z (m/s^2)"
9.364549000E-3,1.003170490E0,3.543418407E0,7.366958618E0
1.136538300E-2,9.696516991E-1,3.600879431E0,7.357381821E0
1.336699700E-2,9.696516991E-1,3.620033026E0,7.343016624E0
```

输入数据包括：

1. 50Hz 采集的加速度和线加速度，单位为 $m/s^2$
2. 50Hz 采集的磁力计读数，单位为 $\mu\text{T}$
3. 50Hz 采集的陀螺仪读数，单位为 $\text{rad}/s$
4. 前 10% 时间的 1Hz 的 GPS 位置读数：
   1. 经纬度，单位为 $\degree$
   2. 高度，单位为 $m$
   3. 速度，单位为 $m/s$
   4. 方位角，单位为 $\degree$
   5. 垂直和水平精度，单位为 $m$

（这里可以附上英文，例如 纬度（latitude））

<div style="text-align: center;">
    <img alt="" src="images/2022-12-01-15-09-28.png" width="50%" />
</div>
<div style="text-align: center; font-size: small">
    <b>Figure 1.</b> 一张图片
    <br />
    <br />
</div>

（以及可以附上一些解释的图片，图片可以在论文上找，比如上面那张，也可以用 drawio 之类的东西自己画，也可以用 python plt 画好放上来）


### 1.3 输出

输出为后 90% 时间的 1Hz 的 GPS 位置读数中的经纬度和方位角，即不需要输出速度、高度和精度。

输出也是 CSV 格式。

（这里可以说一下那三个文件的关系：`Location.csv`, `Location_input.csv`，`Location_output.csv`，特别是 `Location_output.csv`）

**文档要求：**

- **统一使用中文标点符号；**
- **中文和英文之间要隔一个空格；**
- **每一个段落空一行。**
- **图片统一保存在 `./images` 文件夹下**

![](images/example.png)



## 二、数据收集与处理

### 2.1 数据收集

数据收集工作由多组合作完成，使用软件 phyphox（中文名：手机物理工坊）。

我们在多种设备上收集并使用了以下四种状态采集到的数据：

1. 步行，手机拿在手上，且是看手机的姿势
2. 步行，手机拿在手上，随着摆臂运动
3. 步行，手机放在背包内
4. 步行，手机放在裤兜内

每种数据都收集了多组。在单次收集过程中，手机大部分时间保持在同一个状态下。

（也可以提一下每一个类别大概记录了多少组，还有我们现在不分类了，所以骑自行车之类的数据其实也可以加上去，虽然可能并不是室内，但是可以作为迁移场景说一下）


### 2.2 数据划分

在实验中如何对数据进行划分。（曹明隽）


## 三、总体思路

### 3.1 前期思考

（方盛俊）

经过分析，我们发现 PDR 算法的关键只有两点：

1. 如何预测出任给一个时间点的已走过的 **路程**。
2. 如何预测出任给一个时间点的对应 **前进方向**。

我们很容易猜想 **路程** 在 **理论上** 应该是通过 **加速计加速度** 二重积分得到的，方向应该是经过 **陀螺仪角速度** 一重积分得到的。

但是事实上理论和实践有着很大的差距，我们测量出来的 **加速度** 和 **角速度** 总是在不断的振荡，与真实数据存在非常大的误差，这是因为：

1. 手机并不是固定在人的身上的，例如手机拿在手上时，就会随着手的活动不断摇摆振荡；
2. 手机自带的加速度计和陀螺仪就存在着一定的误差。

所以根据积分来计算出路程和方向的想法是不可行的，我们需要思考准确性和稳定性更强的方案。

这里我们发现：

1. 加速度的幅值的振荡频率和行人的步伐振荡频率强相关；
2. 磁力计的磁场强度与前进方向强相关（磁场强度方向指向北方）；
3. 我们拥有前 10% 的数据，可以从中学得很多有用的信息，比如每走一步的长度，再比如初始的前进方向。

根据这三个线索，我们制定了下面的 PDR 算法思路。


### 3.2 二级标题

### 3.1.1 三级标题

总体思路为步伐检测和方向预测。（任圣杰、方盛俊)

公式：

$$
\begin{equation}
    \begin{cases}
        X_k = X_{k-1} + L_{k-1,k} \cdot \cos(\theta_{k-1, k}) \\
        Y_k = Y_{k-1} + L_{k-1,k} \cdot \sin(\theta_{k-1, k}) \\
    \end{cases}
\end{equation}
$$

模型使用的算法没有限制，可以自行选择自己认为合理的算法。比如，可以直接把这个任务看成一个线性或者非线性的回归问题，也可以将此任务看成一个时间序列预测的问题，或者训练模型分别预测移动方向和移动速度，从而计算出当前位置，亦或利用强化学习解决这个问题等。但需要在实验报告中体现出该方法的合理性。


## 四、数据预处理

（方盛俊）


## 五、步伐检测

尝试使用了哪些方法，为什么使用这些方法，方法的效果怎么样，如果效果不好，可能的原因时什么，如何解决这些问题。以及在迁移场景的完成情况。（任圣杰）


## 六、方向预测

尝试使用了哪些方法，为什么使用这些方法，方法的效果怎么样，如果效果不好，可能的原因时什么，如何解决这些问题。以及迁移场景的完成情况。（方盛俊）


## 七、统一算法

如何合并以上的代码（任圣杰、方盛俊）


## 八、运行代码

如何运行代码。（曹明隽）


## 九、性能测试

在完成代码后测试，然后完成报告。（曹明隽）

### 9.1 在 test_case0 上的运行情况

包括模型推理准确性以及推理速度等。

### 9.2 在测试数据集上的运行情况

包括模型推理准确性以及推理速度等。

### 9.3 在收集数据集上的运行情况

包括模型推理准确性以及推理速度等。

### 9.4 迁移场景的完成情况

可能会和上一小节合并。


## 十、小组分工

分工情况。（方盛俊）


## 十一、参考文献

参考文献。（曹明隽、任圣杰、方盛俊）

